<div class="calendar-container">
  <div class="calendar-header">
    <div class="calendar-title">
      <h2>{{ viewDate | date:'MMMM y' }}</h2>
    </div>
    <div class="calendar-navigation">
      <button class="btn btn-primary" mwlCalendarPreviousView [view]="view" [(viewDate)]="viewDate">
        Previous
      </button>
      <button class="btn btn-outline-secondary" mwlCalendarToday [(viewDate)]="viewDate">
        Today
      </button>
      <button class="btn btn-primary" mwlCalendarNextView [view]="view" [(viewDate)]="viewDate">
        Next
      </button>
    </div>
  </div>

  <div [ngSwitch]="view">
    <mwl-calendar-week-view
      *ngSwitchCase="CalendarView.Week"
      [viewDate]="viewDate"
      [events]="events"
      [dayStartHour]="dayStartHour"
      [dayEndHour]="dayEndHour"
      [hourSegments]="hourSegments"
      [hourSegmentHeight]="hourSegmentHeight"
      [refresh]="refresh"
      (eventClicked)="handleEventClick($event)"
      (hourSegmentClicked)="handleSlotClick($event)"
      [headerTemplate]="customHeader"
      [precision]="'minutes'"
      [tooltipTemplate]="eventTooltip">
    </mwl-calendar-week-view>
  </div>
</div>

<ng-template #eventTooltip let-event="event">
  <div [innerHTML]="getEventTooltip(event)"></div>
</ng-template>

<ng-template #customHeader let-days="days" let-locale="locale">
  <div class="cal-day-headers">
    <div
      class="cal-header"
      *ngFor="let day of days"
      [class.cal-past]="day.isPast"
      [class.cal-today]="day.isToday"
      [class.cal-future]="day.isFuture">
      <b>{{ day.date | date:'EEE' }}</b><br>
      <span>{{ day.date | date:'d' }}</span><br>
      <small>{{ getAppointmentCount(day.date) }} appointments</small>
    </div>
  </div>
</ng-template>

<!-- Appointment Form Modal -->
<div class="modal" *ngIf="showAppointmentForm" [class.show]="showAppointmentForm">
  <div class="modal-backdrop" (click)="closeForm()"></div>
  <div class="modal-content">
    <app-appointment-form
      [startTime]="selectedSlot!"
      [availableSlots]="availableSlots"
      (submitAppointment)="handleAppointmentSubmit($event)"
      (cancel)="closeForm()">
    </app-appointment-form>
  </div>
</div>
