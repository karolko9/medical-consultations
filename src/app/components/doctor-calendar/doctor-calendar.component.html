<div class="calendar-container">
  <mwl-calendar-week-view
    [viewDate]="viewDate"
    [events]="events"
    [refresh]="refresh"
    [dayStartHour]="dayStartHour"
    [dayEndHour]="dayEndHour"
    [hourSegments]="hourSegments"
    [hourSegmentHeight]="hourSegmentHeight"
    (beforeViewRender)="beforeWeekViewRender($event)"
    [headerTemplate]="customHeader"
    (eventClicked)="handleEventClick($event)"
    (hourSegmentClicked)="handleSlotClick($event)"
    [tooltipTemplate]="tooltipTemplate">
  </mwl-calendar-week-view>
</div>

<ng-template #tooltipTemplate let-event="event">
  <div [innerHTML]="getEventTooltip(event)"></div>
</ng-template>

<ng-template #customHeader let-days="days" let-locale="locale">
  <div class="cal-day-headers">
    <div
      class="cal-header"
      *ngFor="let day of days"
      [class.cal-past]="day.isPast"
      [class.cal-today]="day.isToday"
      [class.cal-future]="day.isFuture"
      [class.cal-weekend]="day.isWeekend">
      {{ day.date | date:'EEEE' | titlecase }}
      <div class="cal-day-number">{{ day.date | date:'d' }}</div>
      <span class="appointment-count" *ngIf="day.appointmentCount && day.appointmentCount > 0">
        {{ day.appointmentCount }} {{ day.appointmentCount === 1 ? 'wizyta' : 'wizyty' }}
      </span>
    </div>
  </div>
</ng-template>

<app-appointment-form
  *ngIf="showAppointmentForm && selectedSlot"
  [selectedDate]="selectedSlot"
  [availableSlots]="availableSlots"
  (appointmentSubmitted)="onAppointmentSubmitted($event)"
  (formClosed)="closeForm()">
</app-appointment-form>
